<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Gift</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #0a0a14;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            position: relative;
            color: #ffffff;
        }
        
        canvas {
            display: block;
            background: transparent;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        .ui-container {
            position: fixed;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            min-width: 280px;
            justify-content: center;
        }
        
        .score-container {
            color: #4dc9ff;
            font-size: 18px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 8px;
            background: rgba(77, 201, 255, 0.1);
            border: 1px solid rgba(77, 201, 255, 0.15);
            min-width: 80px;
            text-align: center;
        }
        
        .speed-container {
            color: #6bffb8;
            font-size: 16px;
            font-weight: 500;
            padding: 4px 12px;
            border-radius: 8px;
            background: rgba(107, 255, 184, 0.1);
            border: 1px solid rgba(107, 255, 184, 0.15);
            min-width: 70px;
            text-align: center;
        }
        
        .record-container {
            color: #ff9a9e;
            font-size: 16px;
            font-weight: 500;
            padding: 4px 12px;
            border-radius: 8px;
            background: rgba(255, 154, 158, 0.1);
            border: 1px solid rgba(255, 154, 158, 0.15);
            min-width: 70px;
            text-align: center;
        }
        
        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            color: rgba(255, 255, 255, 0.4);
            font-size: 14px;
            text-align: center;
            pointer-events: none;
            z-index: 10;
            padding: 16px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            font-weight: 400;
            letter-spacing: 0.3px;
        }
        
        .special-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 32px 40px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #222;
            font-size: 24px;
            font-weight: 600;
            text-align: center;
            z-index: 30;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 500px;
            width: 90vw;
            line-height: 1.4;
        }
        
        .special-message.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .special-message span {
            display: block;
            font-size: 16px;
            color: #666;
            margin-top: 12px;
            font-weight: 500;
        }
        
        .special-message .instructions {
            font-size: 14px;
            color: #555;
            margin-top: 20px;
            line-height: 1.5;
            max-width: 300px;
            font-weight: 400;
        }
        
        .special-message .bot-link {
            color: #4dc9ff;
            font-weight: 600;
            text-decoration: none;
            margin-top: 8px;
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(77, 201, 255, 0.1);
        }
        
        .continue-button {
            margin-top: 24px;
            padding: 12px 32px;
            background: #4dc9ff;
            color: #000;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .continue-button:hover {
            background: #3ab5ed;
            transform: translateY(-1px);
        }
        
        .continue-button:active {
            transform: translateY(0);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .ui-container {
                top: 8px;
                padding: 6px 12px;
                gap: 8px;
                min-width: 250px;
            }
            
            .score-container {
                font-size: 16px;
                padding: 4px 8px;
                min-width: 60px;
            }
            
            .speed-container,
            .record-container {
                font-size: 14px;
                padding: 4px 8px;
                min-width: 60px;
            }
            
            .controls {
                font-size: 13px;
                padding: 12px;
            }
            
            .special-message {
                padding: 24px;
                font-size: 20px;
            }
            
            .special-message span {
                font-size: 14px;
            }
            
            .special-message .instructions {
                font-size: 13px;
            }
            
            .continue-button {
                font-size: 15px;
                padding: 10px 24px;
                margin-top: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .ui-container {
                min-width: 220px;
            }
            
            .score-container {
                font-size: 15px;
                min-width: 55px;
            }
            
            .speed-container,
            .record-container {
                font-size: 13px;
                min-width: 55px;
            }
        }
        
        /* Animation for score change */
        @keyframes scorePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .score-pulse {
            animation: scorePulse 0.2s ease;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div class="ui-container">
        <div class="score-container" id="scoreDisplay">0</div>
        <div class="speed-container" id="speedDisplay">1.0x</div>
        <div class="record-container" id="recordDisplay">üèÜ 0</div>
    </div>
    
    <div class="special-message" id="specialMessage">
        üéâ CONGRATULATIONS! üéâ
        <span>Special Candy Collected!</span>
        <div class="instructions">
            To claim your reward, take a screenshot of this message and send it to
            <span class="bot-link">https://t.me/Cvapik_bot</span>
        </div>
        <button class="continue-button" id="continueButton">Continue</button>
    </div>
    <div class="controls">cvapta.com</div>

    <script>
        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const speedDisplay = document.getElementById('speedDisplay');
        const recordDisplay = document.getElementById('recordDisplay');
        const specialMessage = document.getElementById('specialMessage');
        const continueButton = document.getElementById('continueButton');
        
        // Record system
        let bestRecord = localStorage.getItem('cosmicGiftBestRecord') || 0;
        recordDisplay.textContent = `üèÜ ${bestRecord}`;
        
        // Variables to prevent accidental clicks
        let isSpecialMessageActive = false;
        let lastInteractionTime = 0;
        const INTERACTION_COOLDOWN = 1000;
        
        // Keyboard state
        let spaceKeyPressed = false;
        
        // Canvas resize
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initGameDimensions();
        }
        
        // Game dimensions
        let centerX, centerY, playerSize, orbitRadius, devilSize, baseDevilSpeed;
        
        function initGameDimensions() {
            centerX = canvas.width / 2;
            centerY = canvas.height / 2;
            
            const minDimension = Math.min(canvas.width, canvas.height);
            playerSize = minDimension * 0.045;
            orbitRadius = minDimension * 0.32;
            devilSize = minDimension * 0.035;
            baseDevilSpeed = minDimension * 0.0022;
        }
        
        // Emojis
        const giftEmoji = 'üéÅ';
        const treeEmoji = 'üéÑ';
        const devilEmoji = 'üëø';
        const specialCandyEmoji = 'üç≠';
        
        // Game variables
        let playerAngle = 0;
        let clockwise = true;
        let devils = [];
        let specialCandy = null;
        let lastDevilTime = 0;
        let baseDevilInterval = 850;
        let gameRunning = true;
        let explosionParticles = [];
        let giftRotation = 0;
        let lastSpecialSpawn = 0;
        let specialSpawnCooldown = 15000;
        let specialSpawnChance = 0.005;
        
        // Boost system
        let specialSpawnChanceBoost = 0;
        let boostActiveTime = 0;
        let boostTotalTime = 600;
        let boostEffect = false;
        
        // Score and difficulty - –ò–ù–ò–¶–ò–ê–õ–¨–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø
        let score = 0;
        let gameTime = 0;
        let speedMultiplier = 1.0;
        let devilSpeedMultiplier = 1.0;
        let devilIntervalMultiplier = 1.0;
        let lastScoreTime = Date.now();
        let lastSpeedIncreaseTime = Date.now();
        
        // Win flag
        let isWin = false;
        
        // Death and respawn system
        let isDead = false;
        let deathTime = 0;
        let respawnDelay = 1000;
        
        // Shooting animation
        let nextShotAngle = 0;
        let chargeTime = 0;
        let isCharging = false;
        let aimLineLength = 0;
        
        // Background stars
        let backgroundStars = [];
        
        function initStars() {
            backgroundStars = [];
            const starCount = 50;
            
            for (let i = 0; i < starCount; i++) {
                backgroundStars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 1.2 + 0.3,
                    speed: Math.random() * 0.1 + 0.02,
                    opacity: Math.random() * 0.4 + 0.2
                });
            }
        }
        
        // Score and difficulty update
        function updateScoreAndDifficulty() {
            if (isWin || isDead) return;
            
            const now = Date.now();
            const deltaTime = now - lastScoreTime;
            
            if (deltaTime >= 1000) {
                score += 10;
                gameTime += 1;
                lastScoreTime = now;
                updateScoreDisplay();
            }
            
            if (now - lastSpeedIncreaseTime >= 1000) {
                speedMultiplier = Math.min(speedMultiplier + 0.12, 10);
                devilSpeedMultiplier = Math.min(devilSpeedMultiplier + 0.15, 12);
                devilIntervalMultiplier = Math.max(devilIntervalMultiplier - 0.06, 0.3);
                
                lastSpeedIncreaseTime = now;
                updateSpeedDisplay();
            }
        }
        
        function updateScoreDisplay() {
            scoreDisplay.textContent = score;
            scoreDisplay.classList.add('score-pulse');
            
            setTimeout(() => {
                scoreDisplay.classList.remove('score-pulse');
            }, 200);
        }
        
        function updateSpeedDisplay() {
            const speedValue = speedMultiplier.toFixed(1);
            speedDisplay.textContent = `${speedValue}x`;
        }
        
        // Record check and update
        function checkAndUpdateRecord() {
            if (score > bestRecord) {
                bestRecord = score;
                localStorage.setItem('cosmicGiftBestRecord', bestRecord);
                recordDisplay.textContent = `üèÜ ${bestRecord}`;
                
                recordDisplay.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    recordDisplay.style.transform = 'scale(1)';
                }, 300);
            }
        }
        
        // –°–±—Ä–æ—Å –∏–≥—Ä—ã –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
        function resetGame() {
            // –°–±—Ä–æ—Å –≤—Å–µ—Ö –∏–≥—Ä–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            score = 0;
            gameTime = 0;
            speedMultiplier = 1.0;
            devilSpeedMultiplier = 1.0;
            devilIntervalMultiplier = 1.0;
            lastScoreTime = Date.now();
            lastSpeedIncreaseTime = Date.now();
            
            playerAngle = 0;
            clockwise = true;
            devils = [];
            specialCandy = null;
            explosionParticles = [];
            giftRotation = 0;
            lastSpecialSpawn = 0;
            specialSpawnChanceBoost = 0;
            boostActiveTime = 0;
            boostEffect = false;
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–º–µ—Ä—Ç–∏
            isDead = false;
            deathTime = 0;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏—Å–ø–ª–µ–µ–≤
            updateScoreDisplay();
            updateSpeedDisplay();
        }
        
        // Create devil
        function createDevil() {
            if (isWin || isDead) return;
            
            const angle = Math.random() * Math.PI * 2;
            
            nextShotAngle = angle;
            isCharging = true;
            chargeTime = 0;
            aimLineLength = 0;
            
            setTimeout(() => {
                let devilCount = 1;
                if (speedMultiplier > 6 && Math.random() > 0.65) devilCount = 3;
                else if (speedMultiplier > 3 && Math.random() > 0.75) devilCount = 2;
                
                for (let i = 0; i < devilCount; i++) {
                    const spread = devilCount === 1 ? 0 : 
                                  devilCount === 2 ? (i === 0 ? -0.16 : 0.16) :
                                  (i - 1) * 0.1;
                    
                    devils.push({
                        x: centerX,
                        y: centerY,
                        angle: angle + spread,
                        emoji: devilEmoji,
                        trail: [],
                        rotation: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.05,
                        spawnTime: Date.now(),
                        speedBonus: 0.85 + Math.random() * 0.25,
                        isSpecial: false
                    });
                }
                
                const now = Date.now();
                if (!specialCandy && 
                    now - lastSpecialSpawn > specialSpawnCooldown && 
                    Math.random() < (specialSpawnChance + specialSpawnChanceBoost)) {
                    
                    specialCandy = {
                        x: centerX,
                        y: centerY,
                        angle: Math.random() * Math.PI * 2,
                        emoji: specialCandyEmoji,
                        trail: [],
                        rotation: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.08,
                        spawnTime: Date.now(),
                        isSpecial: true,
                        speedMultiplier: 2.0
                    };
                    
                    lastSpecialSpawn = now;
                }
                
            }, Math.max(250, 600 / speedMultiplier));
        }
        
        // Transform demons to candies (F4)
        function transformDemonsToCandies() {
            if (isWin || devils.length === 0 || isDead) return;
            
            devils.forEach(devil => {
                devil.emoji = 'üç≠';
                devil.isSpecial = true;
                devil.rotationSpeed = (Math.random() - 0.5) * 0.08;
            });
            
            // Create transformation particles
            for (let i = 0; i < 15; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 2 + 1;
                const size = Math.random() * 12 + 6;
                const life = Math.random() * 30 + 20;
                const emoji = ['üç≠', '‚ú®'][Math.floor(Math.random() * 2)];
                
                explosionParticles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    size: size,
                    life: life,
                    maxLife: life,
                    emoji: emoji,
                    rotation: Math.random() * Math.PI * 2
                });
            }
        }
        
        // Show win message
        function showWinMessage() {
            isWin = true;
            gameRunning = false;
            isSpecialMessageActive = true;
            
            specialMessage.classList.add('active');
            
            // Create celebration particles
            for (let i = 0; i < 25; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 1;
                const size = Math.random() * 16 + 8;
                const life = Math.random() * 50 + 30;
                const emoji = ['‚ú®', '‚≠ê', 'üéâ'][Math.floor(Math.random() * 3)];
                
                explosionParticles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    size: size,
                    life: life,
                    maxLife: life,
                    emoji: emoji,
                    rotation: Math.random() * Math.PI * 2
                });
            }
            
            checkAndUpdateRecord();
        }
        
        // Player death with explosion and respawn
        function playerDeath(x, y) {
            if (isDead || isWin) return;
            
            isDead = true;
            deathTime = Date.now();
            
            // Create explosion particles
            for (let i = 0; i < 25; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 1;
                const size = Math.random() * 14 + 8;
                const life = Math.random() * 40 + 30;
                const emoji = ['üí•', '‚ú®', '‚≠ê'][Math.floor(Math.random() * 3)];
                
                explosionParticles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    size: size,
                    life: life,
                    maxLife: life,
                    emoji: emoji,
                    rotation: Math.random() * Math.PI * 2
                });
            }
            
            checkAndUpdateRecord();
        }
        
        // Continue to Telegram
        function continueToTelegram() {
            const now = Date.now();
            
            if (now - lastInteractionTime < INTERACTION_COOLDOWN) {
                return;
            }
            
            lastInteractionTime = now;
            
            if (!isSpecialMessageActive) {
                return;
            }
            
            const confirmed = confirm("Go to Telegram bot? You'll need to take a screenshot of the win message first.");
            
            if (confirmed) {
                isSpecialMessageActive = false;
                specialMessage.classList.remove('active');
                
                setTimeout(() => {
                    window.open('https://t.me/Cvapik_bot', '_blank');
                }, 300);
            }
        }
        
        // Show boost message
        function showBoostMessage() {
            // Simple boost indicator
            speedDisplay.style.color = '#ffd166';
            setTimeout(() => {
                if (!isWin && !isDead) {
                    speedDisplay.style.color = '#6bffb8';
                }
            }, 500);
        }
        
        // Create explosion particles
        function getRandomSparkleColor() {
            const colors = [
                'rgba(255, 100, 100, 0.5)',
                'rgba(100, 255, 100, 0.5)',
                'rgba(100, 100, 255, 0.5)',
                'rgba(255, 255, 100, 0.5)'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // Draw devil or candy
        function drawDevil(devil) {
            devil.trail.push({ 
                x: devil.x, 
                y: devil.y,
                rotation: devil.rotation
            });
            
            if (devil.trail.length > 2) devil.trail.shift();
            
            // Draw trail
            devil.trail.forEach((point, i) => {
                const progress = i / devil.trail.length;
                const alpha = progress * 0.3;
                
                ctx.save();
                ctx.translate(point.x, point.y);
                ctx.rotate(point.rotation);
                ctx.globalAlpha = alpha;
                ctx.scale(0.3 + progress * 0.5, 0.3 + progress * 0.5);
                
                ctx.font = `${devilSize * 0.9}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = '#ffffff';
                ctx.fillText(devil.emoji, 0, 0);
                
                ctx.restore();
            });
            
            devil.rotation += devil.rotationSpeed;
            
            // Draw devil/candy
            ctx.save();
            ctx.translate(devil.x, devil.y);
            ctx.rotate(devil.rotation);
            
            ctx.font = `${devilSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#ffffff';
            ctx.fillText(devil.emoji, 0, 0);
            
            ctx.restore();
        }
        
        // Draw special candy
        function drawSpecialCandy(candy) {
            candy.trail.push({ 
                x: candy.x, 
                y: candy.y,
                rotation: candy.rotation
            });
            
            if (candy.trail.length > 3) candy.trail.shift();
            
            // Draw trail
            candy.trail.forEach((point, i) => {
                const progress = i / candy.trail.length;
                const alpha = progress * 0.4;
                
                ctx.save();
                ctx.translate(point.x, point.y);
                ctx.rotate(point.rotation);
                ctx.globalAlpha = alpha;
                ctx.scale(0.4 + progress * 0.4, 0.4 + progress * 0.4);
                
                ctx.font = `${devilSize}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = '#ffffff';
                ctx.fillText('üç≠', 0, 0);
                
                ctx.restore();
            });
            
            candy.rotation += candy.rotationSpeed;
            
            // Draw candy with simple glow
            ctx.save();
            ctx.translate(candy.x, candy.y);
            ctx.rotate(candy.rotation);
            
            // Simple glow effect
            ctx.font = `${devilSize * 1.4}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#ffffff';
            ctx.fillText('üç≠', 0, 0);
            
            ctx.restore();
        }
        
        // Draw player
        function drawGift() {
            if (isDead || (!gameRunning && !isWin)) return;
            
            const giftX = centerX + Math.cos(playerAngle) * orbitRadius;
            const giftY = centerY + Math.sin(playerAngle) * orbitRadius;
            
            giftRotation += clockwise ? 0.02 * speedMultiplier : -0.02 * speedMultiplier;
            
            ctx.save();
            ctx.translate(giftX, giftY);
            ctx.rotate(giftRotation);
            
            ctx.font = `${playerSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#ffffff';
            ctx.fillText('üéÅ', 0, 0);
            
            ctx.restore();
        }
        
        // Draw tree
        function drawTree() {
            if (isCharging && !isWin && !isDead) {
                chargeTime += 1;
                
                aimLineLength = Math.min(Math.min(canvas.width, canvas.height) * 0.3, aimLineLength + 4 * speedMultiplier);
                
                // Simple aim line
                ctx.strokeStyle = 'rgba(150, 50, 50, 0.3)';
                ctx.lineWidth = 1;
                ctx.setLineDash([4, 3]);
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(
                    centerX + Math.cos(nextShotAngle) * aimLineLength,
                    centerY + Math.sin(nextShotAngle) * aimLineLength
                );
                ctx.stroke();
                ctx.setLineDash([]);
                
                if (chargeTime >= 70 / speedMultiplier) {
                    isCharging = false;
                    aimLineLength = 0;
                }
            }
            
            // Draw tree
            ctx.font = `${playerSize * 1.8}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#4a9e5a';
            ctx.fillText('üéÑ', centerX, centerY);
        }
        
        // Draw explosion particles
        function drawExplosionParticles() {
            explosionParticles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.02;
                p.vx *= 0.99;
                p.life--;
                
                if (p.life <= 0) {
                    explosionParticles.splice(i, 1);
                    return;
                }
                
                const alpha = p.life / p.maxLife;
                
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation);
                ctx.globalAlpha = alpha * 0.8;
                
                ctx.font = `${p.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(p.emoji, 0, 0);
                
                ctx.restore();
            });
        }
        
        // Draw boost indicator
        function drawBoostIndicator() {
            if (specialSpawnChanceBoost > 0 && boostActiveTime > 0 && !isWin && !isDead) {
                const remainingTime = (boostActiveTime / 60).toFixed(1);
                const boostX = canvas.width - 80;
                const boostY = canvas.height - 60;
                
                ctx.fillStyle = 'rgba(255, 209, 102, 0.15)';
                ctx.fillRect(boostX - 40, boostY - 15, 80, 30);
                
                ctx.strokeStyle = 'rgba(255, 209, 102, 0.3)';
                ctx.lineWidth = 1;
                ctx.strokeRect(boostX - 40, boostY - 15, 80, 30);
                
                ctx.fillStyle = '#ffd166';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('BOOST', boostX, boostY - 2);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '11px Arial';
                ctx.fillText(`${remainingTime}s`, boostX, boostY + 8);
            }
        }
        
        // Background
        function drawBackground() {
            // Solid background
            ctx.fillStyle = '#0a0a14';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Simple stars
            backgroundStars.forEach(star => {
                star.y += star.speed * speedMultiplier * 0.5;
                if (star.y > canvas.height) {
                    star.y = -2;
                    star.x = Math.random() * canvas.width;
                }
                
                ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        
        // Check collisions
        function checkCollisions() {
            if (isDead || isWin) return;
            
            const giftX = centerX + Math.cos(playerAngle) * orbitRadius;
            const giftY = centerY + Math.sin(playerAngle) * orbitRadius;
            
            devils.forEach((devil, i) => {
                const dx = giftX - devil.x;
                const dy = giftY - devil.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < playerSize/2 + devilSize/2) {
                    if (devil.isSpecial) {
                        score += 100;
                        updateScoreDisplay();
                        devils.splice(i, 1);
                        
                        // Create collection particles
                        for (let j = 0; j < 8; j++) {
                            const angle = Math.random() * Math.PI * 2;
                            const speed = Math.random() * 2 + 0.5;
                            const size = Math.random() * 8 + 4;
                            const life = Math.random() * 20 + 15;
                            
                            explosionParticles.push({
                                x: devil.x,
                                y: devil.y,
                                vx: Math.cos(angle) * speed,
                                vy: Math.sin(angle) * speed,
                                size: size,
                                life: life,
                                maxLife: life,
                                emoji: '‚ú®',
                                rotation: Math.random() * Math.PI * 2
                            });
                        }
                    } else {
                        playerDeath(giftX, giftY);
                        devils.splice(i, 1);
                    }
                }
            });
            
            if (specialCandy) {
                const dx = giftX - specialCandy.x;
                const dy = giftY - specialCandy.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < playerSize/2 + devilSize/2) {
                    showWinMessage();
                    specialCandy = null;
                }
            }
        }
        
        // Game update
        function update() {
            // Handle respawn - –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –í–û–ó–†–û–ñ–î–ï–ù–ò–ï –ß–ï–†–ï–ó 1 –°–ï–ö–£–ù–î–£
            if (isDead) {
                const now = Date.now();
                if (now - deathTime > respawnDelay) {
                    // –°–ë–†–û–° –í–°–ï–• –ü–ê–†–ê–ú–ï–¢–†–û–í –ü–†–ò –ù–û–í–û–ú –†–ê–£–ù–î–ï
                    resetGame();
                    lastDevilTime = now;
                }
                
                // Update explosion particles
                explosionParticles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.02;
                    p.life--;
                    
                    if (p.life <= 0) explosionParticles.splice(i, 1);
                });
                return;
            }
            
            updateScoreAndDifficulty();
            
            // Handle boost timer
            if (specialSpawnChanceBoost > 0 && !isWin) {
                boostActiveTime--;
                if (boostActiveTime <= 0) {
                    specialSpawnChanceBoost = 0;
                    boostEffect = false;
                }
            }
            
            // Handle space key - toggle direction
            if (spaceKeyPressed && !isWin && !isDead) {
                clockwise = !clockwise;
                spaceKeyPressed = false;
            }
            
            if (!isWin && !isDead) {
                playerAngle += clockwise ? 0.015 * speedMultiplier : -0.015 * speedMultiplier;
            }
            
            if (!isWin && !isDead) {
                const now = Date.now();
                const currentDevilInterval = baseDevilInterval * devilIntervalMultiplier;
                
                if (now - lastDevilTime > currentDevilInterval && !isCharging) {
                    createDevil();
                    lastDevilTime = now;
                }
                
                // Update devils
                devils.forEach((devil, i) => {
                    const actualSpeed = baseDevilSpeed * devilSpeedMultiplier * devil.speedBonus;
                    devil.x += Math.cos(devil.angle) * actualSpeed;
                    devil.y += Math.sin(devil.angle) * actualSpeed;
                    
                    const dx = devil.x - centerX;
                    const dy = devil.y - centerY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > Math.max(canvas.width, canvas.height) * 0.5) {
                        devils.splice(i, 1);
                    }
                });
                
                // Update special candy
                if (specialCandy) {
                    const specialSpeed = baseDevilSpeed * devilSpeedMultiplier * 2.0;
                    specialCandy.x += Math.cos(specialCandy.angle) * specialSpeed;
                    specialCandy.y += Math.sin(specialCandy.angle) * specialSpeed;
                    specialCandy.rotation += specialCandy.rotationSpeed;
                    
                    const dx = specialCandy.x - centerX;
                    const dy = specialCandy.y - centerY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > Math.max(canvas.width, canvas.height) * 0.55) {
                        specialCandy = null;
                    }
                }
            }
            
            checkCollisions();
        }
        
        // Draw game
        function draw() {
            drawBackground();
            drawTree();
            devils.forEach(drawDevil);
            
            if (specialCandy) {
                drawSpecialCandy(specialCandy);
            }
            
            if (!isDead) {
                drawGift();
            }
            
            drawExplosionParticles();
            drawBoostIndicator();
        }
        
        // Toggle direction for click/touch
        function toggleDirection() {
            if (isWin) return;
            
            if (isDead) {
                // Don't allow toggling while dead
                return;
            }
            
            clockwise = !clockwise;
        }
        
        // Activate chance boost (F8)
        function activateChanceBoost() {
            if (isWin || isDead) return;
            
            specialSpawnChanceBoost = 0.05;
            boostActiveTime = boostTotalTime;
            
            showBoostMessage();
            
            console.log('Chance increased by 5% for 10 seconds!');
        }
        
        // Transform demons to candy (F4)
        function transformDemonsToCandiesHandler() {
            if (isWin || isDead) return;
            
            transformDemonsToCandies();
        }
        
        // Game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Initialization
        resizeCanvas();
        initStars();
        updateScoreDisplay();
        updateSpeedDisplay();
        
        // Event handlers
        canvas.addEventListener('click', toggleDirection);
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            toggleDirection();
        }, { passive: false });
        
        // Keyboard event handlers
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!spaceKeyPressed) {
                    spaceKeyPressed = true;
                }
            }
            
            if (e.code === 'F8') {
                e.preventDefault();
                activateChanceBoost();
            }
            
            if (e.code === 'F4') {
                e.preventDefault();
                transformDemonsToCandiesHandler();
            }
        });
        
        // Continue button handler
        continueButton.addEventListener('click', continueToTelegram);
        continueButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            e.stopPropagation();
            continueToTelegram();
        }, { passive: false });
        
        // Window resize
        window.addEventListener('resize', () => {
            resizeCanvas();
            initStars();
        });
        
        // Start game
        gameLoop();
    </script>
</body>
</html>